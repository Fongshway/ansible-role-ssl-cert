# Defines the cfssl profile to use: one of server,client,peer,intermediate
ssl_cert_type: server

# Filename used to store the certificate
ssl_cert_name: "{{ ansible_hostname }}"

# Certificate subject
ssl_cert_subject:
  common_name: "{{ ansible_hostname }}"
  country: GB
  city: London
  state: Greater London
  organization_name: Ansible Certificate
  organizational_unit_name: Certificate

# Hosts to be included as IP/DNS SAN entries
ssl_cert_hosts:
  - "{{ ssl_cert_subject.common_name }}"

# Defines how to store the certificate and keys: one of file,k8s-secret
ssl_cert_storage: file

# Configuration for file storage
ssl_cert_file_base_dir: /etc/pki/ansible-ssl-certs
ssl_cert_file:
  # Derived fully qualified file names
  cert: "{{ ssl_cert_file_base_dir }}/{{ ssl_cert_name }}.pem"
  key: "{{ ssl_cert_file_base_dir }}/{{ ssl_cert_name }}-key.pem"
  chain: "{{ ssl_cert_file_base_dir }}/{{ ssl_cert_name }}-chain.pem"

# Derived CSR JSON
ssl_cert_csr_json_data: >
  {
    "CN": "{{ ssl_cert_subject.common_name }}",
    "hosts": [ "{{ ssl_cert_hosts | join ('", "') }}" ],
    "key": {
      "algo": "rsa",
      "size": 2048
    },
    "names": [
      {
        "C": "{{ ssl_cert_subject.country }}",
        "L": "{{ ssl_cert_subject.city }}",
        "O": "{{ ssl_cert_subject.organization_name }}",
        "OU": "{{ ssl_cert_subject.organizational_unit_name }}",
        "ST": "{{ ssl_cert_subject.state }}"
      }
    ]
  }

# The delegate host holding the CA key to sign the certificate
ssl_cert_ca_delegate: "{{ groups['ca_nodes'][0] }}"

# The base directory on the delegate host containing signing key, certificate
ssl_cert_ca_delegate_base_dir: /etc/pki/ansible-ssl-certs

# Location of the signing key and certificate on the delegate host
ssl_cert_ca_delegate_name: "{{ 'ca' if ssl_cert_type == 'intermediate' else 'intermediate' }}"

# Derived fully qualified file names on the delegate host
ssl_cert_ca_delegate_key: "{{ ssl_cert_ca_delegate_name }}-key.pem"
ssl_cert_ca_delegate_cert: "{{ ssl_cert_ca_delegate_name }}.pem"
ssl_cert_ca_delegate_chain: "{{ ssl_cert_ca_delegate_name }}-chain.pem"
